import{b as X}from"./chunk-SUKLYF6Z.js";import{A as Y,B as Z,C as G,D as U,z as B}from"./chunk-TQY73KEU.js";import{b as Q,c as k,e as v,f as M,g as L,j as O,l as V,m as P,n as me,o as de,p as ue,r as R,t as j}from"./chunk-R4N7MW4K.js";import{b as w,c as N,d as F}from"./chunk-GR2IEN4H.js";import{$ as S,$b as _,Hb as W,Ia as g,La as d,Rb as se,Sb as C,Ta as r,Tb as I,Ua as e,Va as s,Wa as ne,Xa as ae,Za as T,ab as f,cb as b,fa as y,ga as E,gb as ce,kc as z,lb as i,mb as $,mc as A,nb as h,nc as J,qc as K,ub as x,vb as le,wa as l,wb as H,xa as p}from"./chunk-NZE57U5H.js";function Se(n,c){if(n&1&&(r(0,"option",26),i(1),e()),n&2){let m=c.$implicit;d("value",m),l(),h(" ",m," ")}}function xe(n,c){n&1&&(r(0,"div",27)(1,"div",12)(2,"label",28),i(3,"New Group Type"),e()(),r(4,"div",14),s(5,"input",29),e()())}var fe=(()=>{let c=class c{constructor(t,o,a,u){this.fb=t,this.dialogRef=o,this.data=a,this.dialog=u,this.groupTypes=["Architect","Structural Engineer","Civil Engineer","Soil Engineer (Geotech)","Environmental Engineer","Surveyor","Arborist","Consultant"],this.groupForm=this.fb.group({groupName:["",v.required],groupCity:[""],groupType:["",v.required],newGroupType:[""]})}ngOnInit(){}onCancel(){this.dialogRef.close()}onAddGroup(){let t=this.groupForm.value;t.groupType==="addNewType"&&t.newGroupType&&(this.groupTypes.push(t.newGroupType),t.groupType=t.newGroupType),this.dialogRef.close(t)}onGroupTypeChange(t){t.value==="addNewType"&&this.openNewGroupTypeDialog()}openNewGroupTypeDialog(){let t=prompt("Enter new group type:");t&&(this.groupTypes.push(t),this.groupForm.patchValue({groupType:t}))}};c.\u0275fac=function(o){return new(o||c)(p(R),p(Y),p(Z),p(G))},c.\u0275cmp=S({type:c,selectors:[["app-add-group-dialog"]],standalone:!0,features:[x],decls:39,vars:4,consts:[[1,"card"],[1,"card-body"],[1,"grid-item","mb-4"],[1,"me-3"],[1,"modal-body","text-start"],[1,"modal-toggle-wrapper"],[1,"row"],[3,"formGroup"],["formControlName","subcontractorId","type","hidden"],[1,"form","theme-form","basic-form"],[1,"col-mm-4"],[1,"row","mb-1"],[1,"col-sm-3"],["for","groupName",1,"f-w-500","form-label"],[1,"col-sm-9"],["type","text","placeholder","Enter group name","id","groupName","formControlName","groupName",1,"form-control"],["for","groupCity",1,"f-w-500","form-label"],["type","text","placeholder","Enter group city","id","groupCity","formControlName","groupCity",1,"form-control"],["for","groupType",1,"f-w-500"],["id","groupType","formControlName","groupType",1,"form-select",3,"selectionChange"],[3,"value",4,"ngFor","ngForOf"],["value","addNewType"],["class","row mb-4",4,"ngIf"],[1,"grid-item","text-end"],["type","submit",1,"btn","btn-primary","me-3",3,"click","disabled"],["type","button",1,"btn","btn-secondary",3,"click"],[3,"value"],[1,"row","mb-4"],["for","newGroupType",1,"f-w-500"],["type","text","placeholder","Provide new group type","id","newGroupType","formControlName","newGroupType",1,"form-control"]],template:function(o,a){o&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"h3",3),i(4,"Group Subcontractor"),e()(),r(5,"div",4)(6,"div",5)(7,"div",6)(8,"form",7),s(9,"input",8),r(10,"div",9)(11,"div",10)(12,"div",11)(13,"div",12)(14,"label",13),i(15,"Name"),e()(),r(16,"div",14),s(17,"input",15),e()(),r(18,"div",11)(19,"div",12)(20,"label",16),i(21,"City"),e()(),r(22,"div",14),s(23,"input",17),e()(),r(24,"div",11)(25,"div",12)(26,"label",18),i(27,"Type"),e()(),r(28,"div",14)(29,"select",19),f("selectionChange",function(D){return a.onGroupTypeChange(D)}),g(30,Se,2,2,"option",20),r(31,"option",21),i(32,"Add New Type"),e()()()(),g(33,xe,6,0,"div",22),e()(),r(34,"div",23)(35,"button",24),f("click",function(){return a.onAddGroup()}),i(36," Add "),e(),r(37,"button",25),f("click",function(){return a.onCancel()}),i(38," Cancel "),e()()()()()()()()),o&2&&(l(8),d("formGroup",a.groupForm),l(22),d("ngForOf",a.groupTypes),l(3),d("ngIf",a.groupForm.value.groupType==="addNewType"),l(2),d("disabled",a.groupForm.invalid))},dependencies:[_,C,I,X,j,O,de,ue,k,me,M,L,V,P]});let n=c;return n})();function _e(n,c){if(n&1&&(r(0,"div",18)(1,"span"),i(2),e()()),n&2){let m=c.$implicit;l(2),h("",m.groupName,",")}}function ye(n,c){if(n&1&&(r(0,"div",14)(1,"div",15)(2,"div",16)(3,"h4"),i(4,"Groups"),e()(),g(5,_e,3,1,"div",56),e()()),n&2){let m=b();l(5),d("ngForOf",m.groups)}}function Ee(n,c){n&1&&(r(0,"div",38)(1,"p"),i(2,"No groups available."),e()())}var re=(()=>{let c=class c{constructor(t,o,a,u,D){this.fb=t,this.apiService=o,this.dialogRef=a,this.data=u,this.dialog=D,this.subcontractors=[],this.selectedSubcontractors=new Set,this.subcontractorGroups=[],this.groups=[],this.isEdit=!1,this.userEmail=N.getEmail(),this.subcontractorForm=this.fb.group({subcontractorId:[""],companyName:["",v.required],contactName:["",v.required],pdfUpload:[""],address:[""],contactPhoneNumber:[""],website:[""],contactEmail:["",[v.required,v.email]],ubi:[""],license:[""],taxId:[""],other:[""],insuranceCompany:[""],insuranceAgent:[""],insurancePhone:[""],insuranceEmail:[""],additionalInsured:[!1],certificatePDFURL:[""],additionalInsurancePDFURL:[""]})}trackById(t,o){return o.id}ngOnInit(){this.getSubcontractorGroups(),this.subcontractorId=this.data.subcontractorId||null,this.subcontractorForm.patchValue({subcontractorId:this.subcontractorId}),console.log("Received subcontractorId:",this.subcontractorId),this.subcontractorId&&this.apiService.getSubcontractorById(this.userEmail,this.subcontractorId).subscribe(t=>{t&&(this.subcontractorForm.patchValue(t),this.selectedSubcontractors.add(t.id))},t=>console.error("Error loading subcontractor:",t)),this.apiService.getSubcontractorGroups(this.userEmail).subscribe(t=>{this.groups=t},t=>{console.error("Error fetching groups:",t)})}getSubcontractorGroups(){this.apiService.getSubcontractorGroups(this.userEmail).subscribe(t=>{this.subcontractorGroups=t},t=>{console.error("Error fetching subcontractor groups:",t)})}onSaveClick(){this.subcontractorForm.valid?this.subcontractorId?this.apiService.updateSubcontractor(this.userEmail,this.subcontractorId,this.subcontractorForm.value).subscribe(()=>{this.dialogRef.close(!0)},t=>console.error("Error updating subcontractor:",t)):this.apiService.createSubcontractor(this.userEmail,this.subcontractorForm.value).subscribe(()=>{this.dialogRef.close(!0)},t=>console.error("Error creating subcontractor:",t)):(this.alertInvalidForm(),console.log("Form is invalid"))}onNoClick(){this.dialogRef.close()}alertInvalidForm(){let t=Object.keys(this.subcontractorForm.controls).filter(o=>this.subcontractorForm.controls[o].invalid);alert(`The following fields are required: ${t.join(", ")}`)}deleteSubcontractor(){let t=this.subcontractorForm.value.subcontractorId;console.log("Attempting to delete subcontractor with ID:",t),confirm("Are you sure you want to delete this subcontractor?")&&this.apiService.deleteSubcontractor(this.userEmail,t).subscribe(()=>{this.subcontractors=this.subcontractors.filter(o=>o.id!==t),this.dialogRef.close(!0)},o=>{console.error("Error deleting subcontractor:",o),alert("An error occurred while deleting the subcontractor. Please try again.")})}addToGroup(){let t=Array.from(this.selectedSubcontractors);if(t.length===0){console.error("No subcontractors selected.");return}let o=new B;o.width="800px",o.autoFocus=!0,o.position={top:"0px",left:"33%"},this.dialog.open(fe,o).afterClosed().subscribe(u=>{u&&this.apiService.addSubcontractorsToGroup(this.userEmail,t,u.groupName,u.groupCity,u.groupType).subscribe({next:()=>{console.log("Subcontractors added to group successfully."),this.getSubcontractorGroups()},error:D=>{console.error("Error adding subcontractors to group:",D)}})})}isSelected(t){return this.selectedSubcontractors.has(t)}toggleSubcontractorSelection(t){this.selectedSubcontractors.has(t)?this.selectedSubcontractors.delete(t):this.selectedSubcontractors.add(t)}};c.\u0275fac=function(o){return new(o||c)(p(R),p(F),p(Y),p(Z),p(G))},c.\u0275cmp=S({type:c,selectors:[["app-subcontractors-dialog"]],standalone:!0,features:[x],decls:120,vars:11,consts:[[1,"card"],[1,"card-body"],[1,"grid-item","mb-4"],[1,"me-3"],[1,"text-end"],[1,"btn","btn-primary",3,"click"],[3,"icon"],[1,"modal-body","text-start"],[1,"modal-toggle-wrapper"],[1,"row"],[3,"ngSubmit","formGroup"],["formControlName","subcontractorId","type","hidden"],["type","checkbox",2,"display","none",3,"change","checked","id"],[1,"form","theme-form","basic-form","mb-4"],[1,"col-mm-4"],[1,"row","mb-1"],[1,"col-sm-3"],["for","ubi",1,"f-w-500","form-label"],[1,"col-sm-9"],["type","text","placeholder","UBI #","id","ubi","formControlName","ubi",1,"form-control"],["for","taxId",1,"f-w-500","form-label"],["type","text","placeholder","Tax ID #","id","taxId","formControlName","taxId",1,"form-control"],["for","license",1,"f-w-500"],["type","text","placeholder","License #","id","license","formControlName","license",1,"form-control"],[1,"row","mb-4"],["for","other",1,"f-w-500"],["type","text","placeholder","Other","id","other","formControlName","other",1,"form-control"],[1,"mb-3"],["for","contactName",1,"f-w-500","form-label"],["type","text","placeholder","Name","id","contactName","formControlName","contactName",1,"form-control"],["for","address",1,"f-w-500","form-label"],["type","text","placeholder","Address","id","address","formControlName","address",1,"form-control"],["for","contactPhoneNumber",1,"f-w-500","form-label"],["type","text","placeholder","Phone #","id","contactPhoneNumber","formControlName","contactPhoneNumber",1,"form-control"],["for","contactEmail",1,"f-w-500","form-label"],["type","text","placeholder","Email","id","contactEmail","formControlName","contactEmail",1,"form-control"],["for","website",1,"f-w-500","form-label"],["type","text","placeholder","Url address","id","website","formControlName","website",1,"form-control"],[1,"col-mm-4","mb-4"],["for","insuranceCompany",1,"f-w-500","form-label"],["type","text","placeholder","Name","id","insuranceCompany","formControlName","insuranceCompany",1,"form-control"],["for","insuranceAgent",1,"f-w-500","form-label"],["type","text","placeholder","Agent","id","insuranceAgent","formControlName","insuranceAgent",1,"form-control"],["for","insurancePhone",1,"f-w-500","form-label"],["type","text","placeholder","Phone #","id","insurancePhone","formControlName","insurancePhone",1,"form-control"],["for","insuranceEmail",1,"f-w-500","form-label"],["type","text","placeholder","Email address","id","insuranceEmail","formControlName","insuranceEmail",1,"form-control"],["for","additionalInsured",1,"f-w-500","form-label"],[1,"form-check"],["id","additionalInsured","type","checkbox","formControlName","additionalInsured",1,"form-check-input","primary"],["class","col-mm-4",4,"ngIf"],["class","col-mm-4 mb-4",4,"ngIf"],[1,"grid-item","text-end"],["type","submit",1,"btn","btn-primary","me-3"],[1,"btn","btn-danger","me-3",3,"click"],["type","button",1,"btn","btn-secondary",3,"click"],["class","col-sm-9",4,"ngFor","ngForOf"]],template:function(o,a){o&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"h3",3),i(4),e(),r(5,"div",4)(6,"button",5),f("click",function(){return a.addToGroup()}),s(7,"app-feather-icon",6),i(8," Add to Group "),e()()(),r(9,"div",7)(10,"div",8)(11,"div",9)(12,"form",10),f("ngSubmit",function(){return a.onSaveClick()}),s(13,"input",11),r(14,"input",12),f("change",function(){return a.toggleSubcontractorSelection(a.subcontractorForm.value.subcontractorId)}),e(),r(15,"div",13)(16,"div",14)(17,"div",15)(18,"div",16)(19,"label",17),i(20,"UBI"),e()(),r(21,"div",18),s(22,"input",19),e()(),r(23,"div",15)(24,"div",16)(25,"label",20),i(26,"Tax ID #"),e()(),r(27,"div",18),s(28,"input",21),e()(),r(29,"div",15)(30,"div",16)(31,"label",22),i(32,"License #"),e()(),r(33,"div",18),s(34,"input",23),e()(),r(35,"div",24)(36,"div",16)(37,"label",25),i(38,"Other"),e()(),r(39,"div",18),s(40,"input",26),e()()(),r(41,"div",14)(42,"h4",27),i(43,"Contact Information"),e(),r(44,"div",15)(45,"div",16)(46,"label",28),i(47,"Name"),e()(),r(48,"div",18),s(49,"input",29),e()(),r(50,"div",15)(51,"div",16)(52,"label",30),i(53,"Address"),e()(),r(54,"div",18),s(55,"input",31),e()(),r(56,"div",15)(57,"div",16)(58,"label",32),i(59,"Phone #"),e()(),r(60,"div",18),s(61,"input",33),e()(),r(62,"div",15)(63,"div",16)(64,"label",34),i(65,"Email"),e()(),r(66,"div",18),s(67,"input",35),e()(),r(68,"div",24)(69,"div",16)(70,"label",36),i(71,"Url"),e()(),r(72,"div",18),s(73,"input",37),e()()(),r(74,"div",38)(75,"h4",27),i(76,"Insurance Company"),e(),r(77,"div",15)(78,"div",16)(79,"label",39),i(80,"Name"),e()(),r(81,"div",18),s(82,"input",40),e()(),r(83,"div",15)(84,"div",16)(85,"label",41),i(86,"Agent"),e()(),r(87,"div",18),s(88,"input",42),e()(),r(89,"div",15)(90,"div",16)(91,"label",43),i(92,"Phone #"),e()(),r(93,"div",18),s(94,"input",44),e()(),r(95,"div",15)(96,"div",16)(97,"label",45),i(98,"Email"),e()(),r(99,"div",18),s(100,"input",46),e()(),r(101,"div",15)(102,"div",16)(103,"label",47),i(104,"Additional Insurance"),e()(),r(105,"div",18)(106,"div",48),s(107,"input",49),e()()()(),g(108,ye,6,1,"div",50)(109,Ee,3,0,"div",51),e(),r(110,"div",52)(111,"button",53),s(112,"app-feather-icon",6),i(113," Update "),e(),r(114,"button",54),f("click",function(){return a.deleteSubcontractor()}),s(115,"app-feather-icon",6),i(116," Delete "),e(),r(117,"button",55),f("click",function(){return a.onNoClick()}),s(118,"app-feather-icon",6),i(119," Close "),e()()()()()()()()),o&2&&(l(4),h(" ",a.subcontractorForm.value.companyName||"New Subcontractor"," "),l(3),d("icon","plus-square"),l(5),d("formGroup",a.subcontractorForm),l(2),ce("id","subcontractor-",a.subcontractorForm.value.subcontractorId,""),d("checked",a.isSelected(a.subcontractorForm.value.subcontractorId)),l(94),d("ngIf",a.groups.length),l(),d("ngIf",!a.groups.length),l(3),d("icon","edit"),l(3),d("icon","trash-2"),l(3),d("icon","x"))},dependencies:[_,C,I,X,j,O,k,Q,M,L,V,P,w]});let n=c;return n})();var Ce=()=>["/subcontractors/create"],Ie=n=>({disabled:n});function we(n,c){if(n&1){let m=T();r(0,"span",11),f("click",function(){let o=y(m).$implicit,a=b();return E(a.hasSubcontractors[o]&&a.filterByLetter(o))}),i(1),e()}if(n&2){let m=c.$implicit,t=b();d("ngClass",H(2,Ie,!t.hasSubcontractors[m])),l(),h(" ",m," ")}}function Ne(n,c){n&1&&(r(0,"div")(1,"h3",12),i(2," Please select a letter to view subcontractors starting with that letter. "),e()())}function Fe(n,c){if(n&1){let m=T();r(0,"tr")(1,"td")(2,"input",19),f("change",function(){let o=y(m).$implicit,a=b(2);return E(a.toggleSubcontractorSelection(o.id))}),e()(),r(3,"td",20)(4,"a",21),f("click",function(){let o=y(m).$implicit,a=b(2);return E(a.openDialog(o.id))}),i(5),e()(),r(6,"td",16),i(7),e(),r(8,"td",16),i(9),e(),r(10,"td",16),i(11),e(),r(12,"td",16),i(13),e()()}if(n&2){let m=c.$implicit,t=c.index,o=b(2);l(5),h(" ",m.companyName," "),l(2),h(" ",m.contactName," "),l(2),h(" ",m.companyType," "),l(2),h(" ",m.address," "),l(2),h(" ",o.bidNumber[t]," ")}}function Te(n,c){if(n&1){let m=T();r(0,"div",13)(1,"h3",14),i(2),e(),r(3,"table",15)(4,"thead")(5,"tr"),s(6,"th"),r(7,"th",16)(8,"h4"),i(9,"Subcontractor"),e()(),r(10,"th",16)(11,"h4"),i(12,"Contact"),e()(),r(13,"th",16)(14,"h4"),i(15,"Type"),e()(),r(16,"th",16)(17,"h4"),i(18,"Address"),e()(),r(19,"th",16)(20,"h4"),i(21,"Total Bids"),e()()()(),r(22,"tbody"),g(23,Fe,14,5,"tr",17),e()(),r(24,"div",4)(25,"button",18),f("click",function(){y(m);let o=b();return E(o.bulkDeleteSubcontractors())}),s(26,"app-feather-icon",6),i(27," Delete Selected "),e()()()}if(n&2){let m=b();l(2),h(' Subcontractors starting with "',m.selectedLetter,'" '),l(21),d("ngForOf",m.filteredSubcontractors),l(3),d("icon","trash-2")}}function Ge(n,c){if(n&1&&(r(0,"div")(1,"h3",12),i(2),e()()),n&2){let m=b();l(2),h(' No subcontractors found starting with "',m.selectedLetter,'" ')}}var be=(()=>{let c=class c{constructor(t,o,a,u){this.subcontractorService=t,this.dialog=o,this.cd=a,this.router=u,this.subcontractors=[],this.alphabet="ABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),this.hasClickedLetter=!1,this.filteredSubcontractors=[],this.selectedLetter="",this.selectedSubcontractors=new Set,this.bidNumber=[],this.userEmail=N.getEmail(),this.hasSubcontractors={}}ngOnInit(){this.getSubcontractors()}openDialog(t){console.log("Opening dialog for subcontractorId:",t);let o=new B;o.width="600px",o.autoFocus=!0,o.data={subcontractorId:t};let a=this.dialog.open(re,o);a.afterClosed().subscribe(u=>{u&&console.log("Dialog result:",u)}),a.afterClosed().subscribe(u=>{window.location.reload()})}getSubcontractors(){this.subcontractorService.getSubcontractors(this.userEmail).subscribe(t=>{console.log("Subcontractors fetched:",t),this.subcontractors=t,this.initializeHasSubcontractors(),this.cd.detectChanges(),this.bidNumber=this.subcontractors.map((o,a)=>!o||o.bids===void 0?(console.log(`Subcontractor ${a} does not have bids property, setting bidNumber to 0.`),"0"):(console.log(`Subcontractor ${a} bids set to ${o.bids}`),o.bids.toString()))},t=>{console.error("Error fetching subcontractors:",t)})}initializeHasSubcontractors(){this.alphabet.forEach(t=>{this.hasSubcontractors[t]=this.subcontractors.some(o=>o.companyName?.startsWith(t))})}filterByLetter(t){this.selectedLetter=t,this.filteredSubcontractors=this.subcontractors.filter(o=>o.companyName?.startsWith(t)),this.hasClickedLetter=!0}selectSubcontractor(t){this.selectedSubcontractor=t}bulkDeleteSubcontractors(){let t=Array.from(this.selectedSubcontractors);this.subcontractorService.bulkDeleteSubcontractors(this.userEmail,t).subscribe(()=>{this.subcontractors=this.subcontractors.filter(o=>!this.selectedSubcontractors.has(o.id)),this.selectedSubcontractors.clear(),window.location.reload()},o=>{console.error("Error bulk deleting subcontractors:",o)})}toggleSubcontractorSelection(t){this.selectedSubcontractors.has(t)?this.selectedSubcontractors.delete(t):this.selectedSubcontractors.add(t)}};c.\u0275fac=function(o){return new(o||c)(p(F),p(G),p(W),p(A))},c.\u0275cmp=S({type:c,selectors:[["app-subcontractors"]],standalone:!0,features:[x],decls:17,vars:7,consts:[[1,"container-fluid"],[1,"row"],[1,"col-md-12"],[1,"card"],[1,"card-body","text-end"],[1,"btn","btn-primary",3,"routerLink"],[3,"icon"],[1,"fs-3","alphabet-nav","text-center","mb-5"],["class","alphabet-letter me-3 btn btn-primary",3,"ngClass","click",4,"ngFor","ngForOf"],[4,"ngIf"],["class","table-responsive card-body text-center",4,"ngIf"],[1,"alphabet-letter","me-3","btn","btn-primary",3,"click","ngClass"],[1,"mb-5","text-center"],[1,"table-responsive","card-body","text-center"],[1,"mb-5"],[1,"table","table-borderless","mb-3"],[1,"f-w-300","text-center"],[4,"ngFor","ngForOf"],[1,"btn","btn-danger",3,"click"],["type","checkbox",1,"form-check-input","primary",3,"change"],[1,"f-w-700","text-center"],["href","javascript:void(0)",3,"click"]],template:function(o,a){o&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"a",5),s(6,"app-feather-icon",6),i(7," Add Subcontractor "),e()()()(),r(8,"div",2)(9,"div",3)(10,"div",7),s(11,"br")(12,"br"),g(13,we,2,4,"span",8),e(),g(14,Ne,3,0,"div",9)(15,Te,28,3,"div",10)(16,Ge,3,1,"div",9),e()()()()),o&2&&(l(5),d("routerLink",le(6,Ce)),l(),d("icon","plus-square"),l(7),d("ngForOf",a.alphabet),l(),d("ngIf",!a.hasClickedLetter),l(),d("ngIf",a.filteredSubcontractors.length>0),l(),d("ngIf",a.filteredSubcontractors.length===0&&a.selectedLetter))},dependencies:[_,se,C,I,w,U,K,J]});let n=c;return n})();var he=(()=>{let c=class c{constructor(t,o,a,u,D){this.subcontractorService=t,this.router=o,this.cd=a,this.route=u,this.fb=D,this.fromLineItemOverview=!1,this.subcontractors=[],this.subcontractorGroups=[],this.selectedSubcontractors=new Set,this.projectId="",this.bidNumber=[],this.userEmail=N.getEmail(),this.hasSubcontractors={},this.subcontractorForm=this.fb.group({subcontractorId:[""],companyName:["",v.required],contactName:["",v.required],pdfUpload:[""],address:[""],contactPhoneNumber:[""],website:[""],contactEmail:["",[v.required,v.email]],ubi:[""],license:[""],taxId:[""],other:[""],insuranceCompany:[""],insuranceAgent:[""],insurancePhone:[""],insuranceEmail:[""],additionalInsured:[!1],certificatePDFURL:[""],additionalInsurancePDFURL:[""]})}ngOnInit(){this.getSubcontractorGroups(),this.subcontractorId=this.route.snapshot.paramMap.get("id"),this.fromLineItemOverview=this.route.snapshot.queryParamMap.get("from")==="line-item-overview",this.subcontractorId&&this.subcontractorService.getSubcontractorById(this.userEmail,this.subcontractorId).subscribe(t=>{t&&this.subcontractorForm.patchValue(t)})}onSubmit(){this.subcontractorForm.valid?this.subcontractorId?this.subcontractorService.updateSubcontractor(this.userEmail,this.subcontractorId,this.subcontractorForm.value).subscribe(()=>{this.navigateAfterSubmit()}):this.subcontractorService.createSubcontractor(this.userEmail,this.subcontractorForm.value).subscribe(()=>{this.navigateAfterSubmit()}):(this.alertInvalidForm(),console.log("Form is invalid"))}navigateAfterSubmit(){this.fromLineItemOverview?this.router.navigate(["/subcontractors/list"]):this.router.navigate(["/subcontractors/list"])}alertInvalidForm(){let t=[],o=this.subcontractorForm.controls;for(let a in o)o[a].invalid&&t.push(a);alert(`The following fields are required: ${t.join(", ")}`)}getSubcontractorGroups(){this.subcontractorService.getSubcontractorGroups(this.userEmail).subscribe(t=>{this.subcontractorGroups=t},t=>{console.error("Error fetching subcontractor groups:",t)})}addToGroup(){if(Array.from(this.selectedSubcontractors).length===0){console.error("No subcontractors selected.");return}}goToContractorList(){this.router.navigate(["/subcontractors/list"])}};c.\u0275fac=function(o){return new(o||c)(p(F),p(A),p(W),p(z),p(R))},c.\u0275cmp=S({type:c,selectors:[["app-subcontractors"]],standalone:!0,features:[x],decls:83,vars:3,consts:[[3,"ngSubmit","formGroup"],[1,"container-fluid"],[1,"row"],[1,"col-sm-12"],[1,"card"],[1,"card-body"],["formControlName","subcontractorId","type","hidden"],[1,"form","theme-form","basic-form"],[1,"row","mb-1"],["for","companyName",1,"f-w-500","form-label"],["type","text","placeholder","Enter company name","id","companyName","formControlName","companyName",1,"form-control"],["for","ubi",1,"f-w-500","form-label"],["type","text","placeholder","UBI #","id","ubi","formControlName","ubi",1,"form-control"],["for","taxId",1,"f-w-500","form-label"],["type","text","placeholder","Tax ID #","id","taxId","formControlName","taxId",1,"form-control"],["for","license",1,"f-w-500"],["type","text","placeholder","License #","id","license","formControlName","license",1,"form-control"],[1,"row","mb-4"],["for","other",1,"f-w-500"],["type","text","placeholder","Other","id","other","formControlName","other",1,"form-control"],[1,"mb-3"],["for","contactName",1,"f-w-500","form-label"],["type","text","placeholder","Name","id","contactName","formControlName","contactName",1,"form-control"],["for","address",1,"f-w-500","form-label"],["type","text","placeholder","Address","id","address","formControlName","address",1,"form-control"],["for","contactPhoneNumber",1,"f-w-500","form-label"],["type","text","placeholder","Phone #","id","contactPhoneNumber","formControlName","contactPhoneNumber",1,"form-control"],["for","contactEmail",1,"f-w-500","form-label"],["type","text","placeholder","Email","id","contactEmail","formControlName","contactEmail",1,"form-control"],["for","website",1,"f-w-500","form-label"],["type","text","placeholder","Url address","id","website","formControlName","website",1,"form-control"],["for","insuranceCompany",1,"f-w-500","form-label"],["type","text","placeholder","Name","id","insuranceCompany","formControlName","insuranceCompany",1,"form-control"],["for","insuranceAgent",1,"f-w-500","form-label"],["type","text","placeholder","Agent","id","insuranceAgent","formControlName","insuranceAgent",1,"form-control"],["for","insurancePhone",1,"f-w-500","form-label"],["type","text","placeholder","Phone #","id","insurancePhone","formControlName","insurancePhone",1,"form-control"],["for","insuranceEmail",1,"f-w-500","form-label"],["type","text","placeholder","Email address","id","insuranceEmail","formControlName","insuranceEmail",1,"form-control"],[1,"form-check"],["id","additionalInsured","type","checkbox","formControlName","additionalInsured",1,"form-check-input","primary"],["for","additionalInsured",1,"f-w-500","form-label"],[1,"row","mb-4","me-3"],[1,"col"],[1,"text-end"],["type","submit",1,"btn","btn-primary","me-3"],[3,"icon"],[1,"btn","btn-secondary",3,"click"]],template:function(o,a){o&1&&(r(0,"form",0),f("ngSubmit",function(){return a.onSubmit()}),r(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5),s(6,"input",6),r(7,"div",7)(8,"div",8)(9,"label",9),i(10,"Name:"),e(),s(11,"input",10),e(),r(12,"div",8)(13,"label",11),i(14,"UBI #"),e(),s(15,"input",12),e(),r(16,"div",8)(17,"label",13),i(18,"Tax ID #"),e(),s(19,"input",14),e(),r(20,"div",8)(21,"label",15),i(22,"License #"),e(),s(23,"input",16),e(),r(24,"div",17)(25,"label",18),i(26,"Other"),e(),s(27,"input",19),e(),r(28,"h4",20),i(29,"Contact:"),e(),r(30,"div",8)(31,"label",21),i(32,"Name"),e(),s(33,"input",22),e(),r(34,"div",8)(35,"label",23),i(36,"Address"),e(),s(37,"input",24),e(),r(38,"div",8)(39,"label",25),i(40,"Phone #"),e(),s(41,"input",26),e(),r(42,"div",8)(43,"label",27),i(44,"Email"),e(),s(45,"input",28),e(),r(46,"div",17)(47,"label",29),i(48,"Url"),e(),s(49,"input",30),e(),r(50,"h4",20),i(51,"Insurance:"),e(),r(52,"div",8)(53,"label",31),i(54,"Name"),e(),s(55,"input",32),e(),r(56,"div",8)(57,"label",33),i(58,"Agent"),e(),s(59,"input",34),e(),r(60,"div",8)(61,"label",35),i(62,"Phone #"),e(),s(63,"input",36),e(),r(64,"div",8)(65,"label",37),i(66,"Email"),e(),s(67,"input",38),e(),r(68,"div",8)(69,"div",39),s(70,"input",40),r(71,"label",41),i(72,"Additional Insurance"),e()()()()(),s(73,"br"),r(74,"div",42)(75,"div",43)(76,"div",44)(77,"button",45),s(78,"app-feather-icon",46),i(79," Add Subcontractor "),e(),r(80,"a",47),f("click",function(){return a.goToContractorList()}),s(81,"app-feather-icon",46),i(82," Cancel"),e()()()()()()()()()),o&2&&(d("formGroup",a.subcontractorForm),l(78),d("icon",(a.projectId,"edit")),l(3),d("icon","x"))},dependencies:[_,j,O,k,Q,M,L,V,P,w]});let n=c;return n})();var De=n=>["/subcontractors/groupdetails",n];function Ae(n,c){n&1&&(r(0,"div",6),i(1," There are no groups available. "),e())}function ke(n,c){if(n&1){let m=T();r(0,"tr")(1,"td",12)(2,"a",13),i(3),e()(),r(4,"td",10),i(5),e(),s(6,"td",10)(7,"td",10),r(8,"td",10)(9,"button",14),f("click",function(){let o=y(m).$implicit,a=b(2);return E(a.deleteGroup(o))}),s(10,"app-feather-icon",15),e()()()}if(n&2){let m=c.$implicit;l(2),d("routerLink",H(4,De,m._id)),l(),$(m.groupName),l(2),$(m.groupType),l(5),d("icon","trash-2")}}function Me(n,c){if(n&1&&(r(0,"div")(1,"div",2)(2,"div",3)(3,"div",7)(4,"h3",8),i(5,"Group Directory"),e(),r(6,"table",9)(7,"thead")(8,"tr")(9,"th",10)(10,"h4"),i(11,"Name"),e()(),r(12,"th",10)(13,"h4"),i(14,"Expertise / Field"),e()(),r(15,"th",10)(16,"h4"),i(17,"City"),e()(),r(18,"th",10)(19,"h4"),i(20,"State"),e()(),s(21,"th"),e()(),r(22,"tbody"),g(23,ke,11,6,"tr",11),e()()()()()()),n&2){let m=b();l(23),d("ngForOf",m.subcontractorGroups)}}var ge=(()=>{let c=class c{constructor(t){this.apiService=t,this.subcontractorGroups=[],this.userEmail=N.getEmail()}ngOnInit(){this.getSubcontractorGroups()}getSubcontractorGroups(){this.apiService.getSubcontractorGroups(this.userEmail).subscribe(t=>{this.subcontractorGroups=t},t=>{console.error("Error fetching subcontractor groups:",t)})}deleteGroup(t){confirm("Are you sure you want to delete this group?")&&this.apiService.deleteSubcontractorGroup(this.userEmail,t._id).subscribe(()=>{this.subcontractorGroups=this.subcontractorGroups.filter(o=>o._id!==t._id)},o=>{console.error("Error deleting group:",o)})}};c.\u0275fac=function(o){return new(o||c)(p(F))},c.\u0275cmp=S({type:c,selectors:[["app-subcontractor-group-list"]],standalone:!0,features:[x],decls:6,vars:2,consts:[[1,"container-fluid"],[1,"row"],[1,"col-md-12"],[1,"card"],["role","alert","class","alert alert-light-warning text-center",4,"ngIf"],[4,"ngIf"],["role","alert",1,"alert","alert-light-warning","text-center"],[1,"table-responsive","card-body","text-center"],[1,"mb-5"],[1,"table","table-borderless","mb-3"],[1,"f-w-300","text-center"],[4,"ngFor","ngForOf"],[1,"f-w-700","text-center"],[3,"routerLink"],[1,"btn","btn-danger",3,"click"],[3,"icon"]],template:function(o,a){o&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),g(4,Ae,2,0,"div",4)(5,Me,24,1,"div",5),e()()()()),o&2&&(l(4),d("ngIf",a.subcontractorGroups.length===0),l(),d("ngIf",a.subcontractorGroups.length>0))},dependencies:[_,C,I,w,U,K,J]});let n=c;return n})();function Le(n,c){n&1&&(r(0,"div",12),i(1," There are currently no subcontractors assigned to this group. "),e())}function Oe(n,c){if(n&1){let m=T();ne(0),r(1,"td",18)(2,"a",19),f("click",function(){let o=y(m).ngIf,a=b(4);return E(a.openDialog(o.id))}),i(3),e()(),r(4,"td",15),i(5),e(),r(6,"td",15),i(7),e(),r(8,"td",15),i(9),e(),r(10,"td",15),i(11),e(),ae()}if(n&2){let m=c.ngIf;l(3),h(" ",m.companyName," "),l(2),h(" ",m.contactName," "),l(2),h(" ",m.address," "),l(2),h(" ",m.contactPhoneNumber," "),l(2),h(" ",m.contactEmail," ")}}function Ve(n,c){if(n&1&&(r(0,"tr"),g(1,Oe,12,5,"ng-container",17),e()),n&2){let m=c.$implicit,t=b(3);l(),d("ngIf",t.subcontractors[m])}}function Pe(n,c){if(n&1&&(r(0,"div",13)(1,"table",14)(2,"thead")(3,"tr"),s(4,"th"),r(5,"th",15)(6,"h4"),i(7,"Company"),e()(),r(8,"th",15)(9,"h4"),i(10,"Contact"),e()(),r(11,"th",15)(12,"h4"),i(13,"Address"),e()(),r(14,"th",15)(15,"h4"),i(16,"Phone #"),e()(),r(17,"th",15)(18,"h4"),i(19,"Email"),e()()()(),r(20,"tbody"),g(21,Ve,2,1,"tr",16),e()()()),n&2){let m=b(2);l(21),d("ngForOf",m.group.subcontractorIds)}}function Re(n,c){if(n&1){let m=T();r(0,"div",5)(1,"h3",6),i(2),e(),g(3,Le,2,0,"div",7)(4,Pe,22,1,"div",8),r(5,"div",9)(6,"button",10),f("click",function(){y(m);let o=b();return E(o.deleteGroup())}),s(7,"app-feather-icon",11),i(8," Delete Group "),e()()()}if(n&2){let m=b();l(2),$(m.group.groupName),l(),d("ngIf",!m.group.subcontractorIds||m.group.subcontractorIds.length===0),l(),d("ngIf",m.group.subcontractorIds&&m.group.subcontractorIds.length>0),l(3),d("icon","trash-2")}}var ve=(()=>{let c=class c{constructor(t,o,a,u){this.route=t,this.dialog=o,this.router=a,this.apiService=u,this.group=null,this.id="",this.subcontractors={},this.userEmail=N.getEmail()}ngOnInit(){let t=this.route.snapshot.paramMap.get("groupId");console.log("Fetched Group ID:",t),t?this.apiService.getSubcontractorGroupById(this.userEmail,t).subscribe(o=>{console.log("Fetched Group:",o),this.group=o,o&&o.subcontractorIds?this.loadSubcontractors(o.subcontractorIds):console.warn("No subcontractor IDs found in group")},o=>{console.error("Error fetching subcontractor group:",o)}):console.warn("No Group ID found in route parameters")}openDialog(t){console.log("Opening dialog for subcontractorId:",t);let o=new B;o.width="600px",o.autoFocus=!0,o.data={subcontractorId:t};let a=this.dialog.open(re,o);a.afterClosed().subscribe(u=>{u&&console.log("Dialog result:",u)}),a.afterClosed().subscribe(u=>{window.location.reload()})}loadSubcontractors(t){console.log("Loading subcontractors with IDs:",t),t.forEach(o=>{this.apiService.getSubcontractorById(this.userEmail,o).subscribe(a=>{console.log("Fetched Subcontractor:",a),this.subcontractors[o]=a},a=>{console.error("Error fetching subcontractor:",a)})})}deleteGroup(){this.group&&confirm("Are you sure you want to delete this group?")&&this.apiService.deleteSubcontractorGroup(this.userEmail,this.group._id).subscribe(()=>{this.router.navigate(["/subcontractors"])},t=>{console.error("Error deleting group:",t)})}removeMember(t){this.group&&confirm("Are you sure you want to remove this member from the group?")&&this.apiService.removeMemberFromSubcontractorGroup(this.userEmail,this.group._id,t).subscribe(()=>{delete this.subcontractors[t]},o=>{console.error("Error removing member:",o)})}};c.\u0275fac=function(o){return new(o||c)(p(z),p(G),p(A),p(F))},c.\u0275cmp=S({type:c,selectors:[["app-subcontractor-group-details"]],standalone:!0,features:[x],decls:7,vars:1,consts:[[1,"container-fluid"],[1,"row"],[1,"col-md-12"],[1,"card"],["class","table-responsive card-body text-center",4,"ngIf"],[1,"table-responsive","card-body","text-center"],[1,"mb-5"],["role","alert","class","alert alert-light-warning text-center",4,"ngIf"],["class","table-responsive",4,"ngIf"],[1,"card-body","text-end"],[1,"btn","btn-danger",3,"click"],[3,"icon"],["role","alert",1,"alert","alert-light-warning","text-center"],[1,"table-responsive"],[1,"table","table-borderless","mb-3"],[1,"f-w-300","text-center"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"f-w-700","text-center"],["href","javascript:void(0)",3,"click"]],template:function(o,a){o&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",2)(5,"div",3),g(6,Re,9,4,"div",4),e()()()()()()),o&2&&(l(6),d("ngIf",a.group))},dependencies:[_,C,I,w,U]});let n=c;return n})();var Tt=[{path:"",children:[{path:"list",component:be,data:{title:"Subcontractors List",breadcrumb:"Subcontractors List"}},{path:"create",component:he,data:{title:"Add New Subcontructor",breadcrumb:"Subcontractor Create"}},{path:"grouplist",component:ge,data:{title:"Service Cohort",breadcrumb:"Service Cohort"}},{path:"groupdetails/:groupId",component:ve,data:{title:"Collective Profile",breadcrumb:"Collective Profile"}}]}];export{Tt as Subcontractor};
