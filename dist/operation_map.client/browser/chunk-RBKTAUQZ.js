import{b as X}from"./chunk-L7UN66AV.js";import{B as A,C as Y,D as Z,E as G,F as U}from"./chunk-FGIWCGNG.js";import{b as Q,c as M,e as v,f as L,g as O,k as P,m as R,p as V,q as pe,r as fe,s as be,x as j,z as B}from"./chunk-EKOSDMVG.js";import{b as C,c as I,d as w}from"./chunk-NZVREX32.js";import{$ as S,$b as x,Hb as W,Ia as g,La as d,Rb as ue,Sb as E,Ta as o,Tb as _,Ua as t,Va as s,Wa as le,Xa as se,Za as T,a as ae,ab as f,b as ce,cb as h,fa as N,ga as F,gb as me,kc as z,lb as i,mb as $,mc as k,nb as b,nc as J,qc as K,ub as y,vb as de,wa as l,wb as H,xa as p}from"./chunk-NZE57U5H.js";function xe(a,c){if(a&1&&(o(0,"option",26),i(1),t()),a&2){let m=c.$implicit;d("value",m),l(),b(" ",m," ")}}function Ee(a,c){a&1&&(o(0,"div",27)(1,"div",12)(2,"label",28),i(3,"New Group Type"),t()(),o(4,"div",14),s(5,"input",29),t()())}var ge=(()=>{let c=class c{constructor(e,r,n,u){this.fb=e,this.dialogRef=r,this.data=n,this.dialog=u,this.groupTypes=["Architect","Structural Engineer","Civil Engineer","Soil Engineer (Geotech)","Environmental Engineer","Surveyor","Arborist","Consultant"],this.groupForm=this.fb.group({groupName:["",v.required],groupCity:[""],groupType:["",v.required],newGroupType:[""]})}ngOnInit(){}onCancel(){this.dialogRef.close()}onAddGroup(){let e=this.groupForm.value;e.groupType==="addNewType"&&e.newGroupType&&(this.groupTypes.push(e.newGroupType),e.groupType=e.newGroupType),this.dialogRef.close(e)}onGroupTypeChange(e){e.value==="addNewType"&&this.openNewGroupTypeDialog()}openNewGroupTypeDialog(){let e=prompt("Enter new group type:");e&&(this.groupTypes.push(e),this.groupForm.patchValue({groupType:e}))}};c.\u0275fac=function(r){return new(r||c)(p(j),p(Y),p(Z),p(G))},c.\u0275cmp=S({type:c,selectors:[["app-add-group-dialog"]],standalone:!0,features:[y],decls:39,vars:4,consts:[[1,"card"],[1,"card-body"],[1,"grid-item","mb-4"],[1,"me-3"],[1,"modal-body","text-start"],[1,"modal-toggle-wrapper"],[1,"row"],[3,"formGroup"],["formControlName","subcontractorId","type","hidden"],[1,"form","theme-form","basic-form"],[1,"col-mm-4"],[1,"row","mb-1"],[1,"col-sm-3"],["for","groupName",1,"f-w-500","form-label"],[1,"col-sm-9"],["type","text","placeholder","Enter group name","id","groupName","formControlName","groupName",1,"form-control"],["for","groupCity",1,"f-w-500","form-label"],["type","text","placeholder","Enter group city","id","groupCity","formControlName","groupCity",1,"form-control"],["for","groupType",1,"f-w-500"],["id","groupType","formControlName","groupType",1,"form-select",3,"selectionChange"],[3,"value",4,"ngFor","ngForOf"],["value","addNewType"],["class","row mb-4",4,"ngIf"],[1,"grid-item","text-end"],["type","submit",1,"btn","btn-primary","me-3",3,"click","disabled"],["type","button",1,"btn","btn-secondary",3,"click"],[3,"value"],[1,"row","mb-4"],["for","newGroupType",1,"f-w-500"],["type","text","placeholder","Provide new group type","id","newGroupType","formControlName","newGroupType",1,"form-control"]],template:function(r,n){r&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"h3",3),i(4,"Group Subcontractor"),t()(),o(5,"div",4)(6,"div",5)(7,"div",6)(8,"form",7),s(9,"input",8),o(10,"div",9)(11,"div",10)(12,"div",11)(13,"div",12)(14,"label",13),i(15,"Name"),t()(),o(16,"div",14),s(17,"input",15),t()(),o(18,"div",11)(19,"div",12)(20,"label",16),i(21,"City"),t()(),o(22,"div",14),s(23,"input",17),t()(),o(24,"div",11)(25,"div",12)(26,"label",18),i(27,"Type"),t()(),o(28,"div",14)(29,"select",19),f("selectionChange",function(D){return n.onGroupTypeChange(D)}),g(30,xe,2,2,"option",20),o(31,"option",21),i(32,"Add New Type"),t()()()(),g(33,Ee,6,0,"div",22),t()(),o(34,"div",23)(35,"button",24),f("click",function(){return n.onAddGroup()}),i(36," Add "),t(),o(37,"button",25),f("click",function(){return n.onCancel()}),i(38," Cancel "),t()()()()()()()()),r&2&&(l(8),d("formGroup",n.groupForm),l(22),d("ngForOf",n.groupTypes),l(3),d("ngIf",n.groupForm.value.groupType==="addNewType"),l(2),d("disabled",n.groupForm.invalid))},dependencies:[x,E,_,X,B,P,fe,be,M,pe,L,O,R,V]});let a=c;return a})();function _e(a,c){if(a&1&&(o(0,"div",18)(1,"span"),i(2),t()()),a&2){let m=c.$implicit;l(2),b("",m.groupName,",")}}function Ce(a,c){if(a&1&&(o(0,"div",14)(1,"div",15)(2,"div",16)(3,"h4"),i(4,"Groups"),t()(),g(5,_e,3,1,"div",56),t()()),a&2){let m=h();l(5),d("ngForOf",m.groups)}}function Ie(a,c){a&1&&(o(0,"div",38)(1,"p"),i(2,"No groups available."),t()())}var oe=(()=>{let c=class c{constructor(e,r,n,u,D){this.fb=e,this.apiService=r,this.dialogRef=n,this.data=u,this.dialog=D,this.subcontractors=[],this.selectedSubcontractors=new Set,this.subcontractorGroups=[],this.groups=[],this.isEdit=!1,this.userEmail=I.getEmail(),this.group=u.group,this.subcontractorForm=this.fb.group({subcontractorId:[""],companyName:["",v.required],contactName:["",v.required],pdfUpload:[""],address:[""],contactPhoneNumber:[""],website:[""],contactEmail:["",[v.required,v.email]],ubi:[""],license:[""],taxId:[""],other:[""],insuranceCompany:[""],insuranceAgent:[""],insurancePhone:[""],insuranceEmail:[""],additionalInsured:[!1],certificatePDFURL:[""],additionalInsurancePDFURL:[""]})}trackById(e,r){return r.id}ngOnInit(){if(this.getSubcontractorGroups(),this.subcontractorId=this.data.subcontractorId||null,this.subcontractorForm.patchValue({subcontractorId:this.subcontractorId}),console.log("Received subcontractorId:",this.subcontractorId),this.subcontractorId&&this.apiService.getSubcontractorById(this.userEmail,this.subcontractorId).subscribe(e=>{e&&(this.subcontractorForm.patchValue(e),this.selectedSubcontractors.add(e.id))},e=>console.error("Error loading subcontractor:",e)),this.apiService.getSubcontractorGroups(this.userEmail).subscribe(e=>{this.groups=e},e=>{console.error("Error fetching groups:",e)}),this.subcontractorForm.valid){let e=ce(ae({},this.subcontractorForm.value),{groupId:this.group._id});this.dialogRef.close(e)}}getSubcontractorGroups(){this.apiService.getSubcontractorGroups(this.userEmail).subscribe(e=>{this.subcontractorGroups=e},e=>{console.error("Error fetching subcontractor groups:",e)})}onSaveClick(){this.subcontractorForm.valid?this.subcontractorId?this.apiService.updateSubcontractor(this.userEmail,this.subcontractorId,this.subcontractorForm.value).subscribe(()=>{this.dialogRef.close(!0)},e=>console.error("Error updating subcontractor:",e)):this.apiService.createSubcontractor(this.userEmail,this.subcontractorForm.value).subscribe(()=>{this.dialogRef.close(!0)},e=>console.error("Error creating subcontractor:",e)):(this.alertInvalidForm(),console.log("Form is invalid"))}onNoClick(){this.dialogRef.close()}alertInvalidForm(){let e=Object.keys(this.subcontractorForm.controls).filter(r=>this.subcontractorForm.controls[r].invalid);alert(`The following fields are required: ${e.join(", ")}`)}deleteSubcontractor(){let e=this.subcontractorForm.value.subcontractorId;console.log("Attempting to delete subcontractor with ID:",e),confirm("Are you sure you want to delete this subcontractor?")&&this.apiService.deleteSubcontractor(this.userEmail,e).subscribe(()=>{this.subcontractors=this.subcontractors.filter(r=>r.id!==e),this.dialogRef.close(!0)},r=>{console.error("Error deleting subcontractor:",r),alert("An error occurred while deleting the subcontractor. Please try again.")})}addToGroup(){let e=Array.from(this.selectedSubcontractors);if(e.length===0){console.error("No subcontractors selected.");return}let r=new A;r.width="800px",r.autoFocus=!0,r.position={top:"0px",left:"33%"},this.dialog.open(ge,r).afterClosed().subscribe(u=>{u&&this.apiService.addSubcontractorsToGroup(this.userEmail,e,u.groupName,u.groupCity,u.groupType).subscribe({next:()=>{console.log("Subcontractors added to group successfully."),this.getSubcontractorGroups()},error:D=>{console.error("Error adding subcontractors to group:",D)}})})}isSelected(e){return this.selectedSubcontractors.has(e)}toggleSubcontractorSelection(e){this.selectedSubcontractors.has(e)?this.selectedSubcontractors.delete(e):this.selectedSubcontractors.add(e)}};c.\u0275fac=function(r){return new(r||c)(p(j),p(w),p(Y),p(Z),p(G))},c.\u0275cmp=S({type:c,selectors:[["app-subcontractors-dialog"]],standalone:!0,features:[y],decls:120,vars:11,consts:[[1,"card"],[1,"card-body"],[1,"grid-item","mb-4"],[1,"me-3"],[1,"text-end"],[1,"btn","btn-primary",3,"click"],[3,"icon"],[1,"modal-body","text-start"],[1,"modal-toggle-wrapper"],[1,"row"],[3,"ngSubmit","formGroup"],["formControlName","subcontractorId","type","hidden"],["type","checkbox",2,"display","none",3,"change","checked","id"],[1,"form","theme-form","basic-form","mb-4"],[1,"col-mm-4"],[1,"row","mb-1"],[1,"col-sm-3"],["for","ubi",1,"f-w-500","form-label"],[1,"col-sm-9"],["type","text","placeholder","UBI #","id","ubi","formControlName","ubi",1,"form-control"],["for","taxId",1,"f-w-500","form-label"],["type","text","placeholder","Tax ID #","id","taxId","formControlName","taxId",1,"form-control"],["for","license",1,"f-w-500"],["type","text","placeholder","License #","id","license","formControlName","license",1,"form-control"],[1,"row","mb-4"],["for","other",1,"f-w-500"],["type","text","placeholder","Other","id","other","formControlName","other",1,"form-control"],[1,"mb-3"],["for","contactName",1,"f-w-500","form-label"],["type","text","placeholder","Name","id","contactName","formControlName","contactName",1,"form-control"],["for","address",1,"f-w-500","form-label"],["type","text","placeholder","Address","id","address","formControlName","address",1,"form-control"],["for","contactPhoneNumber",1,"f-w-500","form-label"],["type","text","placeholder","Phone #","id","contactPhoneNumber","formControlName","contactPhoneNumber",1,"form-control"],["for","contactEmail",1,"f-w-500","form-label"],["type","text","placeholder","Email","id","contactEmail","formControlName","contactEmail",1,"form-control"],["for","website",1,"f-w-500","form-label"],["type","text","placeholder","Url address","id","website","formControlName","website",1,"form-control"],[1,"col-mm-4","mb-4"],["for","insuranceCompany",1,"f-w-500","form-label"],["type","text","placeholder","Name","id","insuranceCompany","formControlName","insuranceCompany",1,"form-control"],["for","insuranceAgent",1,"f-w-500","form-label"],["type","text","placeholder","Agent","id","insuranceAgent","formControlName","insuranceAgent",1,"form-control"],["for","insurancePhone",1,"f-w-500","form-label"],["type","text","placeholder","Phone #","id","insurancePhone","formControlName","insurancePhone",1,"form-control"],["for","insuranceEmail",1,"f-w-500","form-label"],["type","text","placeholder","Email address","id","insuranceEmail","formControlName","insuranceEmail",1,"form-control"],["for","additionalInsured",1,"f-w-500","form-label"],[1,"form-check"],["id","additionalInsured","type","checkbox","formControlName","additionalInsured",1,"form-check-input","primary"],["class","col-mm-4",4,"ngIf"],["class","col-mm-4 mb-4",4,"ngIf"],[1,"grid-item","text-end"],["type","submit",1,"btn","btn-primary","me-3"],[1,"btn","btn-danger","me-3",3,"click"],["type","button",1,"btn","btn-secondary",3,"click"],["class","col-sm-9",4,"ngFor","ngForOf"]],template:function(r,n){r&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"h3",3),i(4),t(),o(5,"div",4)(6,"button",5),f("click",function(){return n.addToGroup()}),s(7,"app-feather-icon",6),i(8," Add to Group "),t()()(),o(9,"div",7)(10,"div",8)(11,"div",9)(12,"form",10),f("ngSubmit",function(){return n.onSaveClick()}),s(13,"input",11),o(14,"input",12),f("change",function(){return n.toggleSubcontractorSelection(n.subcontractorForm.value.subcontractorId)}),t(),o(15,"div",13)(16,"div",14)(17,"div",15)(18,"div",16)(19,"label",17),i(20,"UBI"),t()(),o(21,"div",18),s(22,"input",19),t()(),o(23,"div",15)(24,"div",16)(25,"label",20),i(26,"Tax ID #"),t()(),o(27,"div",18),s(28,"input",21),t()(),o(29,"div",15)(30,"div",16)(31,"label",22),i(32,"License #"),t()(),o(33,"div",18),s(34,"input",23),t()(),o(35,"div",24)(36,"div",16)(37,"label",25),i(38,"Other"),t()(),o(39,"div",18),s(40,"input",26),t()()(),o(41,"div",14)(42,"h4",27),i(43,"Contact Information"),t(),o(44,"div",15)(45,"div",16)(46,"label",28),i(47,"Name"),t()(),o(48,"div",18),s(49,"input",29),t()(),o(50,"div",15)(51,"div",16)(52,"label",30),i(53,"Address"),t()(),o(54,"div",18),s(55,"input",31),t()(),o(56,"div",15)(57,"div",16)(58,"label",32),i(59,"Phone #"),t()(),o(60,"div",18),s(61,"input",33),t()(),o(62,"div",15)(63,"div",16)(64,"label",34),i(65,"Email"),t()(),o(66,"div",18),s(67,"input",35),t()(),o(68,"div",24)(69,"div",16)(70,"label",36),i(71,"Url"),t()(),o(72,"div",18),s(73,"input",37),t()()(),o(74,"div",38)(75,"h4",27),i(76,"Insurance Company"),t(),o(77,"div",15)(78,"div",16)(79,"label",39),i(80,"Name"),t()(),o(81,"div",18),s(82,"input",40),t()(),o(83,"div",15)(84,"div",16)(85,"label",41),i(86,"Agent"),t()(),o(87,"div",18),s(88,"input",42),t()(),o(89,"div",15)(90,"div",16)(91,"label",43),i(92,"Phone #"),t()(),o(93,"div",18),s(94,"input",44),t()(),o(95,"div",15)(96,"div",16)(97,"label",45),i(98,"Email"),t()(),o(99,"div",18),s(100,"input",46),t()(),o(101,"div",15)(102,"div",16)(103,"label",47),i(104,"Additional Insurance"),t()(),o(105,"div",18)(106,"div",48),s(107,"input",49),t()()()(),g(108,Ce,6,1,"div",50)(109,Ie,3,0,"div",51),t(),o(110,"div",52)(111,"button",53),s(112,"app-feather-icon",6),i(113," Update "),t(),o(114,"button",54),f("click",function(){return n.deleteSubcontractor()}),s(115,"app-feather-icon",6),i(116," Delete "),t(),o(117,"button",55),f("click",function(){return n.onNoClick()}),s(118,"app-feather-icon",6),i(119," Close "),t()()()()()()()()),r&2&&(l(4),b(" ",n.subcontractorForm.value.companyName||"New Subcontractor"," "),l(3),d("icon","plus-square"),l(5),d("formGroup",n.subcontractorForm),l(2),me("id","subcontractor-",n.subcontractorForm.value.subcontractorId,""),d("checked",n.isSelected(n.subcontractorForm.value.subcontractorId)),l(94),d("ngIf",n.groups.length),l(),d("ngIf",!n.groups.length),l(3),d("icon","edit"),l(3),d("icon","trash-2"),l(3),d("icon","x"))},dependencies:[x,E,_,X,B,P,M,Q,L,O,R,V,C]});let a=c;return a})();var we=()=>["/subcontractors/create"],Ne=a=>({disabled:a});function Fe(a,c){if(a&1){let m=T();o(0,"span",11),f("click",function(){let r=N(m).$implicit,n=h();return F(n.hasSubcontractors[r]&&n.filterByLetter(r))}),i(1),t()}if(a&2){let m=c.$implicit,e=h();d("ngClass",H(2,Ne,!e.hasSubcontractors[m])),l(),b(" ",m," ")}}function Te(a,c){a&1&&(o(0,"div")(1,"h3",12),i(2," Please select a letter to view subcontractors starting with that letter. "),t()())}function Ge(a,c){if(a&1){let m=T();o(0,"tr")(1,"td")(2,"input",19),f("change",function(){let r=N(m).$implicit,n=h(2);return F(n.toggleSubcontractorSelection(r.id))}),t()(),o(3,"td",20)(4,"a",21),f("click",function(){let r=N(m).$implicit,n=h(2);return F(n.openDialog(r.id))}),i(5),t()(),o(6,"td",16),i(7),t(),o(8,"td",16),i(9),t(),o(10,"td",16),i(11),t(),o(12,"td",16),i(13),t()()}if(a&2){let m=c.$implicit,e=c.index,r=h(2);l(5),b(" ",m.companyName," "),l(2),b(" ",m.contactName," "),l(2),b(" ",m.companyType," "),l(2),b(" ",m.address," "),l(2),b(" ",r.bidNumber[e]," ")}}function De(a,c){if(a&1){let m=T();o(0,"div",13)(1,"h3",14),i(2),t(),o(3,"table",15)(4,"thead")(5,"tr"),s(6,"th"),o(7,"th",16)(8,"h4"),i(9,"Subcontractor"),t()(),o(10,"th",16)(11,"h4"),i(12,"Contact"),t()(),o(13,"th",16)(14,"h4"),i(15,"Type"),t()(),o(16,"th",16)(17,"h4"),i(18,"Address"),t()(),o(19,"th",16)(20,"h4"),i(21,"Total Bids"),t()()()(),o(22,"tbody"),g(23,Ge,14,5,"tr",17),t()(),o(24,"div",4)(25,"button",18),f("click",function(){N(m);let r=h();return F(r.bulkDeleteSubcontractors())}),s(26,"app-feather-icon",6),i(27," Delete Selected "),t()()()}if(a&2){let m=h();l(2),b(' Subcontractors starting with "',m.selectedLetter,'" '),l(21),d("ngForOf",m.filteredSubcontractors),l(3),d("icon","trash-2")}}function Ae(a,c){if(a&1&&(o(0,"div")(1,"h3",12),i(2),t()()),a&2){let m=h();l(2),b(' No subcontractors found starting with "',m.selectedLetter,'" ')}}var ve=(()=>{let c=class c{constructor(e,r,n,u){this.subcontractorService=e,this.dialog=r,this.cd=n,this.router=u,this.subcontractors=[],this.alphabet="ABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),this.hasClickedLetter=!1,this.filteredSubcontractors=[],this.selectedLetter="",this.selectedSubcontractors=new Set,this.bidNumber=[],this.userEmail=I.getEmail(),this.hasSubcontractors={}}ngOnInit(){this.getSubcontractors()}openDialog(e){console.log("Opening dialog for subcontractorId:",e);let r=new A;r.width="600px",r.autoFocus=!0,r.data={subcontractorId:e};let n=this.dialog.open(oe,r);n.afterClosed().subscribe(u=>{u&&console.log("Dialog result:",u)}),n.afterClosed().subscribe(u=>{window.location.reload()})}getSubcontractors(){this.subcontractorService.getSubcontractors(this.userEmail).subscribe(e=>{console.log("Subcontractors fetched:",e),this.subcontractors=e,this.initializeHasSubcontractors(),this.cd.detectChanges(),this.bidNumber=this.subcontractors.map((r,n)=>!r||r.bids===void 0?(console.log(`Subcontractor ${n} does not have bids property, setting bidNumber to 0.`),"0"):(console.log(`Subcontractor ${n} bids set to ${r.bids}`),r.bids.toString()))},e=>{console.error("Error fetching subcontractors:",e)})}initializeHasSubcontractors(){this.alphabet.forEach(e=>{this.hasSubcontractors[e]=this.subcontractors.some(r=>r.companyName?.startsWith(e))})}filterByLetter(e){this.selectedLetter=e,this.filteredSubcontractors=this.subcontractors.filter(r=>r.companyName?.startsWith(e)),this.hasClickedLetter=!0}selectSubcontractor(e){this.selectedSubcontractor=e}bulkDeleteSubcontractors(){let e=Array.from(this.selectedSubcontractors);this.subcontractorService.bulkDeleteSubcontractors(this.userEmail,e).subscribe(()=>{this.subcontractors=this.subcontractors.filter(r=>!this.selectedSubcontractors.has(r.id)),this.selectedSubcontractors.clear(),window.location.reload()},r=>{console.error("Error bulk deleting subcontractors:",r)})}toggleSubcontractorSelection(e){this.selectedSubcontractors.has(e)?this.selectedSubcontractors.delete(e):this.selectedSubcontractors.add(e)}};c.\u0275fac=function(r){return new(r||c)(p(w),p(G),p(W),p(k))},c.\u0275cmp=S({type:c,selectors:[["app-subcontractors"]],standalone:!0,features:[y],decls:17,vars:7,consts:[[1,"container-fluid"],[1,"row"],[1,"col-md-12"],[1,"card"],[1,"card-body","text-end"],[1,"btn","btn-primary",3,"routerLink"],[3,"icon"],[1,"fs-3","alphabet-nav","text-center","mb-5"],["class","alphabet-letter me-3 btn btn-primary",3,"ngClass","click",4,"ngFor","ngForOf"],[4,"ngIf"],["class","table-responsive card-body text-center",4,"ngIf"],[1,"alphabet-letter","me-3","btn","btn-primary",3,"click","ngClass"],[1,"mb-5","text-center"],[1,"table-responsive","card-body","text-center"],[1,"mb-5"],[1,"table","table-borderless","mb-3"],[1,"f-w-300","text-center"],[4,"ngFor","ngForOf"],[1,"btn","btn-danger",3,"click"],["type","checkbox",1,"form-check-input","primary",3,"change"],[1,"f-w-700","text-center"],["href","javascript:void(0)",3,"click"]],template:function(r,n){r&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"a",5),s(6,"app-feather-icon",6),i(7," Add Subcontractor "),t()()()(),o(8,"div",2)(9,"div",3)(10,"div",7),s(11,"br")(12,"br"),g(13,Fe,2,4,"span",8),t(),g(14,Te,3,0,"div",9)(15,De,28,3,"div",10)(16,Ae,3,1,"div",9),t()()()()),r&2&&(l(5),d("routerLink",de(6,we)),l(),d("icon","plus-square"),l(7),d("ngForOf",n.alphabet),l(),d("ngIf",!n.hasClickedLetter),l(),d("ngIf",n.filteredSubcontractors.length>0),l(),d("ngIf",n.filteredSubcontractors.length===0&&n.selectedLetter))},dependencies:[x,ue,E,_,C,U,K,J]});let a=c;return a})();var re=(()=>{let c=class c{constructor(e,r,n,u,D){this.subcontractorService=e,this.router=r,this.cd=n,this.route=u,this.fb=D,this.fromLineItemOverview=!1,this.subcontractors=[],this.subcontractorGroups=[],this.selectedSubcontractors=new Set,this.projectId="",this.bidNumber=[],this.userEmail=I.getEmail(),this.hasSubcontractors={},this.subcontractorForm=this.fb.group({subcontractorId:[""],companyName:["",v.required],contactName:["",v.required],pdfUpload:[""],address:[""],contactPhoneNumber:[""],website:[""],contactEmail:["",[v.required,v.email]],ubi:[""],license:[""],taxId:[""],other:[""],insuranceCompany:[""],insuranceAgent:[""],insurancePhone:[""],insuranceEmail:[""],additionalInsured:[!1],certificatePDFURL:[""],additionalInsurancePDFURL:[""]})}ngOnInit(){this.getSubcontractorGroups(),this.subcontractorId=this.route.snapshot.paramMap.get("id"),this.fromLineItemOverview=this.route.snapshot.queryParamMap.get("from")==="line-item-overview",this.subcontractorId&&this.subcontractorService.getSubcontractorById(this.userEmail,this.subcontractorId).subscribe(e=>{e&&this.subcontractorForm.patchValue(e)})}onSubmit(){this.subcontractorForm.valid?this.subcontractorId?this.subcontractorService.updateSubcontractor(this.userEmail,this.subcontractorId,this.subcontractorForm.value).subscribe(()=>{this.navigateAfterSubmit()}):this.subcontractorService.createSubcontractor(this.userEmail,this.subcontractorForm.value).subscribe(()=>{this.navigateAfterSubmit()}):(this.alertInvalidForm(),console.log("Form is invalid"))}navigateAfterSubmit(){this.fromLineItemOverview?this.router.navigate(["/subcontractors/list"]):this.router.navigate(["/subcontractors/list"])}alertInvalidForm(){let e=[],r=this.subcontractorForm.controls;for(let n in r)r[n].invalid&&e.push(n);alert(`The following fields are required: ${e.join(", ")}`)}getSubcontractorGroups(){this.subcontractorService.getSubcontractorGroups(this.userEmail).subscribe(e=>{this.subcontractorGroups=e},e=>{console.error("Error fetching subcontractor groups:",e)})}addToGroup(){if(Array.from(this.selectedSubcontractors).length===0){console.error("No subcontractors selected.");return}}goToContractorList(){this.router.navigate(["/subcontractors/list"])}};c.\u0275fac=function(r){return new(r||c)(p(w),p(k),p(W),p(z),p(j))},c.\u0275cmp=S({type:c,selectors:[["app-subcontractors"]],standalone:!0,features:[y],decls:84,vars:3,consts:[[3,"ngSubmit","formGroup"],["type","hidden","formControlName","groupId"],[1,"container-fluid"],[1,"row"],[1,"col-sm-12"],[1,"card"],[1,"card-body"],["formControlName","subcontractorId","type","hidden"],[1,"form","theme-form","basic-form"],[1,"row","mb-1"],["for","companyName",1,"f-w-500","form-label"],["type","text","placeholder","Enter company name","id","companyName","formControlName","companyName",1,"form-control"],["for","ubi",1,"f-w-500","form-label"],["type","text","placeholder","UBI #","id","ubi","formControlName","ubi",1,"form-control"],["for","taxId",1,"f-w-500","form-label"],["type","text","placeholder","Tax ID #","id","taxId","formControlName","taxId",1,"form-control"],["for","license",1,"f-w-500"],["type","text","placeholder","License #","id","license","formControlName","license",1,"form-control"],[1,"row","mb-4"],["for","other",1,"f-w-500"],["type","text","placeholder","Other","id","other","formControlName","other",1,"form-control"],[1,"mb-3"],["for","contactName",1,"f-w-500","form-label"],["type","text","placeholder","Name","id","contactName","formControlName","contactName",1,"form-control"],["for","address",1,"f-w-500","form-label"],["type","text","placeholder","Address","id","address","formControlName","address",1,"form-control"],["for","contactPhoneNumber",1,"f-w-500","form-label"],["type","text","placeholder","Phone #","id","contactPhoneNumber","formControlName","contactPhoneNumber",1,"form-control"],["for","contactEmail",1,"f-w-500","form-label"],["type","text","placeholder","Email","id","contactEmail","formControlName","contactEmail",1,"form-control"],["for","website",1,"f-w-500","form-label"],["type","text","placeholder","Url address","id","website","formControlName","website",1,"form-control"],["for","insuranceCompany",1,"f-w-500","form-label"],["type","text","placeholder","Name","id","insuranceCompany","formControlName","insuranceCompany",1,"form-control"],["for","insuranceAgent",1,"f-w-500","form-label"],["type","text","placeholder","Agent","id","insuranceAgent","formControlName","insuranceAgent",1,"form-control"],["for","insurancePhone",1,"f-w-500","form-label"],["type","text","placeholder","Phone #","id","insurancePhone","formControlName","insurancePhone",1,"form-control"],["for","insuranceEmail",1,"f-w-500","form-label"],["type","text","placeholder","Email address","id","insuranceEmail","formControlName","insuranceEmail",1,"form-control"],[1,"form-check"],["id","additionalInsured","type","checkbox","formControlName","additionalInsured",1,"form-check-input","primary"],["for","additionalInsured",1,"f-w-500","form-label"],[1,"row","mb-4","me-3"],[1,"col"],[1,"text-end"],["type","submit",1,"btn","btn-primary","me-3"],[3,"icon"],[1,"btn","btn-secondary",3,"click"]],template:function(r,n){r&1&&(o(0,"form",0),f("ngSubmit",function(){return n.onSubmit()}),s(1,"input",1),o(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"div",6),s(7,"input",7),o(8,"div",8)(9,"div",9)(10,"label",10),i(11,"Name:"),t(),s(12,"input",11),t(),o(13,"div",9)(14,"label",12),i(15,"UBI #"),t(),s(16,"input",13),t(),o(17,"div",9)(18,"label",14),i(19,"Tax ID #"),t(),s(20,"input",15),t(),o(21,"div",9)(22,"label",16),i(23,"License #"),t(),s(24,"input",17),t(),o(25,"div",18)(26,"label",19),i(27,"Other"),t(),s(28,"input",20),t(),o(29,"h4",21),i(30,"Contact:"),t(),o(31,"div",9)(32,"label",22),i(33,"Name"),t(),s(34,"input",23),t(),o(35,"div",9)(36,"label",24),i(37,"Address"),t(),s(38,"input",25),t(),o(39,"div",9)(40,"label",26),i(41,"Phone #"),t(),s(42,"input",27),t(),o(43,"div",9)(44,"label",28),i(45,"Email"),t(),s(46,"input",29),t(),o(47,"div",18)(48,"label",30),i(49,"Url"),t(),s(50,"input",31),t(),o(51,"h4",21),i(52,"Insurance:"),t(),o(53,"div",9)(54,"label",32),i(55,"Name"),t(),s(56,"input",33),t(),o(57,"div",9)(58,"label",34),i(59,"Agent"),t(),s(60,"input",35),t(),o(61,"div",9)(62,"label",36),i(63,"Phone #"),t(),s(64,"input",37),t(),o(65,"div",9)(66,"label",38),i(67,"Email"),t(),s(68,"input",39),t(),o(69,"div",9)(70,"div",40),s(71,"input",41),o(72,"label",42),i(73,"Additional Insurance"),t()()()()(),s(74,"br"),o(75,"div",43)(76,"div",44)(77,"div",45)(78,"button",46),s(79,"app-feather-icon",47),i(80," Add Subcontractor "),t(),o(81,"a",48),f("click",function(){return n.goToContractorList()}),s(82,"app-feather-icon",47),i(83," Cancel"),t()()()()()()()()()),r&2&&(d("formGroup",n.subcontractorForm),l(79),d("icon",(n.projectId,"edit")),l(3),d("icon","x"))},dependencies:[x,B,P,M,Q,L,O,R,V,C]});let a=c;return a})();var ke=a=>["/subcontractors/groupdetails",a];function Me(a,c){a&1&&(o(0,"div",6),i(1," There are no groups available. "),t())}function Le(a,c){if(a&1){let m=T();o(0,"tr")(1,"td",12)(2,"a",13),i(3),t()(),o(4,"td",10),i(5),t(),s(6,"td",10)(7,"td",10),o(8,"td",10)(9,"button",14),f("click",function(){let r=N(m).$implicit,n=h(2);return F(n.deleteGroup(r))}),s(10,"app-feather-icon",15),t()()()}if(a&2){let m=c.$implicit;l(2),d("routerLink",H(4,ke,m._id)),l(),$(m.groupName),l(2),$(m.groupType),l(5),d("icon","trash-2")}}function Oe(a,c){if(a&1&&(o(0,"div")(1,"div",2)(2,"div",3)(3,"div",7)(4,"h3",8),i(5,"Group Directory"),t(),o(6,"table",9)(7,"thead")(8,"tr")(9,"th",10)(10,"h4"),i(11,"Name"),t()(),o(12,"th",10)(13,"h4"),i(14,"Expertise / Field"),t()(),o(15,"th",10)(16,"h4"),i(17,"City"),t()(),o(18,"th",10)(19,"h4"),i(20,"State"),t()(),s(21,"th"),t()(),o(22,"tbody"),g(23,Le,11,6,"tr",11),t()()()()()()),a&2){let m=h();l(23),d("ngForOf",m.subcontractorGroups)}}var Se=(()=>{let c=class c{constructor(e){this.apiService=e,this.subcontractorGroups=[],this.userEmail=I.getEmail()}ngOnInit(){this.getSubcontractorGroups()}getSubcontractorGroups(){this.apiService.getSubcontractorGroups(this.userEmail).subscribe(e=>{this.subcontractorGroups=e},e=>{console.error("Error fetching subcontractor groups:",e)})}deleteGroup(e){confirm("Are you sure you want to delete this group?")&&this.apiService.deleteSubcontractorGroup(this.userEmail,e._id).subscribe(()=>{this.subcontractorGroups=this.subcontractorGroups.filter(r=>r._id!==e._id)},r=>{console.error("Error deleting group:",r)})}};c.\u0275fac=function(r){return new(r||c)(p(w))},c.\u0275cmp=S({type:c,selectors:[["app-subcontractor-group-list"]],standalone:!0,features:[y],decls:6,vars:2,consts:[[1,"container-fluid"],[1,"row"],[1,"col-md-12"],[1,"card"],["role","alert","class","alert alert-light-warning text-center",4,"ngIf"],[4,"ngIf"],["role","alert",1,"alert","alert-light-warning","text-center"],[1,"table-responsive","card-body","text-center"],[1,"mb-5"],[1,"table","table-borderless","mb-3"],[1,"f-w-300","text-center"],[4,"ngFor","ngForOf"],[1,"f-w-700","text-center"],[3,"routerLink"],[1,"btn","btn-danger",3,"click"],[3,"icon"]],template:function(r,n){r&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),g(4,Me,2,0,"div",4)(5,Oe,24,1,"div",5),t()()()()),r&2&&(l(4),d("ngIf",n.subcontractorGroups.length===0),l(),d("ngIf",n.subcontractorGroups.length>0))},dependencies:[x,E,_,C,U,K,J]});let a=c;return a})();function Pe(a,c){a&1&&(o(0,"div",13),i(1," There are currently no subcontractors assigned to this group. "),t())}function Re(a,c){if(a&1){let m=T();le(0),o(1,"td",19)(2,"a",20),f("click",function(){let r=N(m).ngIf,n=h(4);return F(n.openDialog(r.id))}),i(3),t()(),o(4,"td",16),i(5),t(),o(6,"td",16),i(7),t(),o(8,"td",16),i(9),t(),o(10,"td",16),i(11),t(),se()}if(a&2){let m=c.ngIf;l(3),b(" ",m.companyName," "),l(2),b(" ",m.contactName," "),l(2),b(" ",m.address," "),l(2),b(" ",m.contactPhoneNumber," "),l(2),b(" ",m.contactEmail," ")}}function Ve(a,c){if(a&1&&(o(0,"tr"),g(1,Re,12,5,"ng-container",18),t()),a&2){let m=c.$implicit,e=h(3);l(),d("ngIf",e.subcontractors[m])}}function je(a,c){if(a&1&&(o(0,"div",14)(1,"table",15)(2,"thead")(3,"tr")(4,"th",16)(5,"h4"),i(6,"Company"),t()(),o(7,"th",16)(8,"h4"),i(9,"Contact"),t()(),o(10,"th",16)(11,"h4"),i(12,"Address"),t()(),o(13,"th",16)(14,"h4"),i(15,"Phone #"),t()(),o(16,"th",16)(17,"h4"),i(18,"Email"),t()()()(),o(19,"tbody"),g(20,Ve,2,1,"tr",17),t()()()),a&2){let m=h(2);l(20),d("ngForOf",m.group.subcontractorIds)}}function Be(a,c){if(a&1&&(o(0,"div",9)(1,"h3",10),i(2),t(),g(3,Pe,2,0,"div",11)(4,je,21,1,"div",12),t()),a&2){let m=h();l(2),$(m.group.groupName),l(),d("ngIf",!m.group.subcontractorIds||m.group.subcontractorIds.length===0),l(),d("ngIf",m.group.subcontractorIds&&m.group.subcontractorIds.length>0)}}var ye=(()=>{let c=class c{constructor(e,r,n,u){this.route=e,this.dialog=r,this.router=n,this.apiService=u,this.group=null,this.subcontractors={},this.userEmail=I.getEmail()}ngOnInit(){let e=this.route.snapshot.paramMap.get("groupId");e?this.apiService.getSubcontractorGroupById(this.userEmail,e).subscribe(r=>{console.log("Fetched Group:",r),this.group=r,r&&r.subcontractorIds?this.loadSubcontractors(r.subcontractorIds):console.warn("No subcontractor IDs found in group")},r=>{console.error("Error fetching subcontractor group:",r)}):console.warn("No Group ID found in route parameters")}openDialog(e){console.log("Opening dialog for subcontractorId:",e);let r=new A;r.width="600px",r.autoFocus=!0,r.data={subcontractorId:e};let n=this.dialog.open(oe,r);n.afterClosed().subscribe(u=>{u&&console.log("Dialog result:",u)}),n.afterClosed().subscribe(()=>{window.location.reload()})}openAddNewSubcontractorDialog(){if(!this.group){console.warn("Group is not loaded yet.");return}let e=new A;e.width="600px",e.height="80%",e.maxHeight="90vh",e.autoFocus=!0,e.data={group:this.group},this.dialog.open(re,e).afterClosed().subscribe(n=>{n&&(console.log("Dialog result:",n),this.addSubcontractorToGroup(n))})}loadSubcontractors(e){console.log("Loading subcontractors with IDs:",e),e.forEach(r=>{this.apiService.getSubcontractorById(this.userEmail,r).subscribe(n=>{console.log("Fetched Subcontractor:",n),this.subcontractors[r]=n},n=>{console.error("Error fetching subcontractor:",n)})})}deleteGroup(){this.group&&confirm("Are you sure you want to delete this group?")&&this.apiService.deleteSubcontractorGroup(this.userEmail,this.group._id).subscribe(()=>{this.router.navigate(["/subcontractors"])},e=>{console.error("Error deleting group:",e)})}removeMember(e){this.group&&confirm("Are you sure you want to remove this member from the group?")&&this.apiService.removeMemberFromSubcontractorGroup(this.userEmail,this.group._id,e).subscribe(()=>{delete this.subcontractors[e]},r=>{console.error("Error removing member:",r)})}addSubcontractorToGroup(e){if(!this.group){console.error("No group is currently selected.");return}if(e.id){let r=this.group.subcontractorIds||[];this.apiService.addSubcontractorsToGroup(this.userEmail,[...r,e.id],this.group.groupName,this.group.groupCity,this.group.groupType).subscribe(()=>{console.log("Subcontractor added successfully"),this.group&&(this.group.subcontractorIds=[...r,e.id],this.subcontractors[e.id]=e)},n=>{console.error("Error adding subcontractor:",n)})}}};c.\u0275fac=function(r){return new(r||c)(p(z),p(G),p(k),p(w))},c.\u0275cmp=S({type:c,selectors:[["app-subcontractor-group-details"]],standalone:!0,features:[y],decls:18,vars:3,consts:[[1,"container-fluid"],[1,"row"],[1,"col-md-12"],[1,"card"],[1,"card-body","text-end"],[1,"btn","btn-primary",3,"click"],[3,"icon"],["class","table-responsive card-body text-center",4,"ngIf"],[1,"btn","btn-danger",3,"click"],[1,"table-responsive","card-body","text-center"],[1,"mb-5"],["role","alert","class","alert alert-light-warning text-center",4,"ngIf"],["class","table-responsive",4,"ngIf"],["role","alert",1,"alert","alert-light-warning","text-center"],[1,"table-responsive"],[1,"table","table-borderless","mb-3"],[1,"f-w-300","text-center"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"f-w-700","text-center"],["href","javascript:void(0)",3,"click"]],template:function(r,n){r&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"button",5),f("click",function(){return n.openAddNewSubcontractorDialog()}),s(6,"app-feather-icon",6),i(7," Add Subcontractor "),t()()()(),o(8,"div",2)(9,"div",2)(10,"div",3),g(11,Be,5,3,"div",7),t()(),o(12,"div",2)(13,"div",3)(14,"div",4)(15,"button",8),f("click",function(){return n.deleteGroup()}),s(16,"app-feather-icon",6),i(17," Delete Group "),t()()()()()()()),r&2&&(l(6),d("icon","plus-square"),l(5),d("ngIf",n.group),l(5),d("icon","trash-2"))},dependencies:[x,E,_,C,U]});let a=c;return a})();var kt=[{path:"",children:[{path:"list",component:ve,data:{title:"Subcontractors List",breadcrumb:"Subcontractors List"}},{path:"create",component:re,data:{title:"Add New Subcontructor",breadcrumb:"Subcontractor Create"}},{path:"grouplist",component:Se,data:{title:"Service Cohort",breadcrumb:"Service Cohort"}},{path:"groupdetails/:groupId",component:ye,data:{title:"Collective Profile",breadcrumb:"Collective Profile"}}]}];export{kt as Subcontractor};
